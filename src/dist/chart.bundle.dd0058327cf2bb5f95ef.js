!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("d3"),require("jQuery"),require("moment"),require("_"));else if("function"==typeof define&&define.amd)define(["d3","jQuery","moment","_"],e);else{var i="object"==typeof exports?e(require("d3"),require("jQuery"),require("moment"),require("_")):e(t.d3,t.jQuery,t.moment,t._);for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(this,function(t,e,i,n){return function(t){function e(n){if(i[n])return i[n].exports;var l=i[n]={i:n,l:!1,exports:{}};return t[n].call(l.exports,l,l.exports,e),l.l=!0,l.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=6)}([function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e){t.exports=i},function(t,e){t.exports=n},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3)],void 0!==(l=function(t,e,i,n){var l=function(t){return void 0===t||null===t},a=function(t,e){this.version="1.0",this.pumpText=null,this.g=t,this.block_xScale=e,this.text_data=null};return a.prototype={draw:function(t){var e=this;this.text_data=t;var i=!1;return this.pumpText=e.g.append("text").datum(t).filter(function(t,e,n){return t.width>12&&(!t.next||t.time!==t.next.time)||($(n).remove(),i=!0,!1)}).attr("class","label").text(function(t){return t.label}).attr("x",function(t,i){return e.block_xScale(t.time)+5}).attr("y",function(t,e){return 14}),i&&(this.pumpText=null),this},update:function(t,e,i){return this.text_data.width=i,this.text_data.time=this.block_xScale.invert(t),null!=this.pumpText?(l(t)||this.pumpText.attr("x",t+5),l(e)||this.pumpText.attr("y",e),l(i)||this.pumpText.attr("width",i)):this.draw(this.text_data),this},updateText:function(t){return this.pumpText.datum(t).text(function(t){return t.label}),this},remove:function(){return null!=this.pumpText&&this.pumpText.remove(),this}},a}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3),i(7),i(13),i(15),i(9),i(10)],void 0!==(l=function(t,e,i,n,l,a,r,s,o){var h=20,c=50,u=function(t){return void 0===t||null===t},d=function(t,e,i,n){if(this.version="1.0",this.svg=null,this.xScale=null,this.yScale=null,this.params={},this.lines=[],this.currentTime=null,this.currentLine=null,this.hoverLine=null,this.startHandle=null,this.endHandle=null,this.chartLegend=null,this.dAxis=null,this.originalData=null,this.updateData=null,this.hasChecked=!1,this.hasDBclick=!1,this.hasPopover=!1,this.isEditing=!1,this.curBlock=null,this.gWIDTH=null,this.option=t,this.element=e,this.describe=i,n||u(this.option.size)){var l=this.element.node().getBoundingClientRect();0==l.width&&0==l.height&&(l=this.option.size),this.params.size={width:l.width,height:l.height};var a=this.option.padding.top+this.option.padding.bottom+32*this.describe.barCount+h;this.params.size.height=a}else this.params.size=this.option.size||{}},u=function(t){return void 0===t||null===t};return d.prototype={draw:function(){function e(t,e){return t>=l.option.padding.left&&t<=l.params.size.width-l.option.padding.right&&e>=l.option.padding.top&&e<=l.params.size.height-l.option.padding.bottom+h}this.svg=this.element.append("svg").attr("width",this.params.size.width).attr("height",this.params.size.height);var i=this.params.size.width-this.option.padding.left-this.option.padding.right;this.xScale=t.scaleTime().domain([this.describe.startTime,this.describe.endTime]).nice(t.timeHour).range([0,i]);var n=this.params.size.height-this.option.padding.top-this.option.padding.bottom;this.yScale=t.scaleBand().domain(this.describe.barNames).range([0,n]);var l=this;return this.svg.on("mousemove",function(){if(null!=l.currentLine&&null!=l.hoverLine&&!l.isEditing){var i=t.mouse(this);e(i[0],i[1])?(l.showHoverLine(i[0]-3),l.hideCurrentLine()):(l.hideHoverLine(),l.showCurrentLine())}}),this},drawAsix:function(){return this.dAxis=new l(this.svg,this.option,this.params,this.xScale,this.yScale),this.dAxis.drawAxis(),this},drawChart:function(t){var e=this;return this.originalData=t,this.updateData=_.cloneDeep(t),_.each(this.updateData,function(t){var i=new a(e.svg,e.xScale,e.yScale,e.option,e.describe);i.drawLine(t),e.lines.push(i)}),this},drawLegend:function(){var t=this,e=this.params.size.width-this.option.padding.right,i=function(e){var i=$(e).text();if("取消"==i)t.refresh();else if(null!=t.curBlock){if("新增"==i)t.curBlock.insertCentre(),t.bind_popover();else if("删除"==i){var n=parseFloat(t.curBlock.block.attr("width"));t.curBlock.leftBlock.addWidth(n),t.curBlock.remove()}t.curBlock=null,t.removeHandles()}};return this.chartLegend=new o(this.element),this.chartLegend.draw(e).drawCancelBtn("right",i).drawDeleteBtn("right",i).drawAddBtn("right",i),this},bind_check:function(){var e=this;this.hasChecked=!0;var i=null,n=function(t){var i=parseFloat(e.curBlock.block.attr("width"))+parseFloat(e.curBlock.block.attr("x")),n=i-t;e.curBlock.update(t,null,n)},l=function(t){if(e.curBlock.changeLeft(),null==e.curBlock.block)e.curBlock=null,e.removeHandles();else if(parseFloat(e.curBlock.block.attr("width"))<5){var t=parseFloat(e.curBlock.block.attr("width"))+parseFloat(e.curBlock.block.attr("x"));e.curBlock.update(t,null,0),e.curBlock.changeLeft(),e.curBlock.remove(),e.curBlock=null,e.removeHandles()}},a=function(t){var i=parseFloat(e.curBlock.block.attr("x")),n=t-i;e.curBlock.update(i,null,n)},r=function(){if(e.curBlock.changeRight(),null==e.curBlock.block)e.curBlock=null,e.removeHandles();else{var t=parseFloat(e.curBlock.block.attr("width")),i=parseFloat(e.curBlock.block.attr("x"));if(t<5)e.curBlock.update(i,null,0),e.curBlock.changeRight(),e.curBlock.remove(),e.curBlock=null,e.removeHandles();else{var n=t+i;e.endHandle.updatePos(n);var l=e.startHandle.pos[0],a=e.endHandle.pos[0];null!=e.startHandle&&e.startHandle.setMaxX(a),null!=e.endHandle&&e.endHandle.setMinX(l)}}},o=function(o,h,c){e.curBlock=c,e.removeHandles(),e.hideHoverLine(),e.isEditing=!0;var u=e.curBlock.blockData.label;"故障"==u?e.chartLegend.add_button.setDisabled(!0):e.chartLegend.add_button.setDisabled(!1),"不定"==u?e.chartLegend.delete_button.setDisabled(!0):e.chartLegend.delete_button.setDisabled(!1),i=$(h[o]);var d=i.parent()[0],p=0;null==e.gWIDTH&&(_.each(d.childNodes,function(t){if("rect"==t.tagName){var e=parseFloat($(t).attr("width"));p+=e}}),e.gWIDTH=p);var v=t.select(d),f=parseFloat(i.attr("x")),k=parseFloat(i.attr("y"))-5;0==f&&"不定"==u||(e.startHandle=new s(v,e.xScale),e.startHandle.drawHandle(f,k).drawHandleText(f,-2).drag_Event(null,n,l));var b=parseFloat(i.attr("width")),x=f+b,m=x-4;x==e.gWIDTH&&"不定"==u||(e.endHandle=new s(v,e.xScale,"end"),e.endHandle.drawHandle(m,k).drawHandleText(m,-2).drag_Event(null,a,r)),null!=e.startHandle&&e.startHandle.setMinX(0).setMaxX(m),null!=e.endHandle&&e.endHandle.setMinX(f+4).setMaxX(e.gWIDTH)};return _.each(this.lines,function(t){t.checkBlock_Event(o)}),this},updateHandles:function(){if(u(this.curBlock)||u(this.curBlock.block))this.removeHandles();else{var t=parseFloat(this.curBlock.block.attr("width")),e=parseFloat(this.curBlock.block.attr("x")),i=t+e;this.endHandle.updatePos(i)}},removeHandles:function(){this.showHoverLine(),this.isEditing=!1,null!=this.startHandle&&this.startHandle.removeHandle(),null!=this.endHandle&&this.endHandle.removeHandle(),this.startHandle=null,this.endHandle=null},bind_dbclick:function(){this.hasDBclick=!0;var t=this;return _.each(this.lines,function(e){var i=function(e,i,n){t.updateHandles()};e.dbclick_Event(i)}),this},bind_popover:function(){function t(t){return'<input type="number" id="pumpvalue" name="pumpvalue" style="width: 50px" value='+t+" max="+c+'><button id="closeBtn" class="popoverBtn red" >关</button>'}this.hasPopover=!0;var e=this;$("[data-toggle='popover']").each(function(i,n){var l=n.__data__.value;null!=l&&void 0!=l||(l=""),$(n).popover({trigger:"click",container:"body",placement:"top",html:"true",content:t(l),animation:!1}).on("click",function(){var t=this,i=t.__data__;$(t).popover("show"),$("#pumpvalue").val(i.value),$(t).siblings("[data-toggle]").on("mouseleave",function(){$(t).popover("hide")});var n=function(t){void 0==t?(i.value=t,i.label="不定"):(t=parseInt(t),i.value=t,t>0?i.label=t:0==t?i.label="关":t<0&&(i.label="故障")),e.curBlock.updateState(i)};$("#pumpvalue").on("change",function(){this.value>c&&(this.value=c),n(this.value),e.removeHandles()}).on("keyup",function(){this.value>c&&(this.value=c),n(this.value),e.removeHandles()}),$("#closeBtn").on("click",function(){i.value=0,i.label="关",e.curBlock.updateState(i),$(t).popover("hide"),e.removeHandles()}),$("#openBtn").on("click",function(){i.value=1,i.label="开",e.curBlock.updateState(i),$(t).popover("hide"),e.removeHandles()})}).on("mouseleave",function(){var t=this;setTimeout(function(){$(".popover:hover").length||$(t).popover("hide")},100)})})},drawCurrentLine:function(){this.currentLine=new r(this.svg,this.option,this.params,this.xScale),this.currentLine.drawLine("current_line");var t=this,e=function(){window.setTimeout(function(){t.hoverLine&&t.hoverLine.isShow||(t.showCurrentLine(),e())},1e4)};return e(),this},showCurrentLine:function(){this.currentTime=new Date;var t=this.xScale(this.currentTime)+this.option.padding.left;return this.currentLine.showLine(t),this},hideCurrentLine:function(){return this.currentLine.hideLine(),this},drawHoverLine:function(){return this.hoverLine=new r(this.svg,this.option,this.params,this.xScale,!0),this.hoverLine.drawLine("hover_line","hover_text"),this},showHoverLine:function(t,e){return this.hoverLine.showLine(t),this},hideHoverLine:function(){return this.hoverLine.hideLine(),this},getSvg:function(){return _this.svg},getParams:function(){return _this.params},getxScale:function(){return _this.xScale},getyScale:function(){return _this.yScale},remove:function(){return this.svg.remove(),this.svg=null,this.xScale=null,this.yScale=null,this.lines=[],this.currentTime=null,this.currentLine=null,this.hoverLine=null,this.startHandle=null,this.endHandle=null,this.chartLegend=null,this.dAxis=null,this.originalData=null,this.hasChecked=!1,this.isEditing=!1,this.curBlock=null,this.option=opt,this.element=ele,this.describe=desc,this},removeChart:function(){return _.each(this.lines,function(t){t.remove()}),this},refresh:function(){return this.isEditing=!1,this.svg.remove(),this.draw(),null!=this.originalData&&this.drawChart(this.originalData),null!=this.dAxis&&this.drawAsix(),this.currentLine&&this.drawCurrentLine(),this.hoverLine&&this.drawHoverLine(),this.hasChecked&&this.bind_check(),this.hasDBclick&&this.bind_dbclick(),this.hasPopover&&this.bind_popover(),this},getData:function(){return this.updateData}},d}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3),i(5)],void 0!==(l=function(t,e,i,n,l){var a={padding:{top:20,left:45,bottom:30,right:20},mode:"Day",showCurrent:!0,edit:!1},r="Day",s=t.timeParse("%Y-%m-%d %H:%M:%S"),o=(t.timeParse("%H:%M"),t.timeParse("%Y-%m-%d %H:%M"),function(e,n){function o(t,e,i){i=i.toLowerCase();var n="";return"csp"==i?0===t?n="关":t>0?n="开":t<0&&(n="故障"):n=0===t?"关":t<0?"故障":t.toString()+" "+(e?e.unitText||"":""),n}function p(e){if(h(e))return console.warn("Input data is null or undfined."),null;v.timelines=[],v.describe={startTime:null,endTime:null,barNames:null,barCount:0};for(var n in e){var l=$.extend({},e[n]);v.timelines.push(l);for(var n in l.values){var a=l.values[n];c(a.time)&&(a.time=s(a.time)),null!=a.value?a.label=o(parseInt(a.value.toFixed(0)),l.unit,l.type):a.label="不定"}for(var p=l.values.sort(function(t,e){return t.time-e.time}),f=[p[0]],n=1,k=p.length;n<k;n++)p[n].value!==p[n-1].value&&f.push(p[n]);if(1==f.length){var b=new Date(f[0].time);b.setDate(b.getDate()+1),b.setHours(0),b.setMinutes(0),b.setSeconds(0);var x={time:b,value:f[0].value,label:f[0].label};f.push(x)}for(var n=0,k=f.length;n<k;n++){var a=f[n];n>0&&(a.prev=f[n-1]),n<k-1&&(a.next=f[n+1])}if(v.option.mode==r){var m=u(f);0===m.time.getHours()&&0===m.time.getMinutes()||(m.time.setHours(0),m.time.setMinutes(0));var g=d(f);if(0!==g.time.getHours()||0!==g.time.getMinutes()||i(g.time).format()!==i(m.time).add(1,"day").format()){var b=new Date(g.time);b.setDate(b.getDate()+1),b.setHours(0),b.setMinutes(0),b.setSeconds(0);var x={time:b,value:null,label:"不定",prev:g};g.next=x,f.push(x)}}l.points=f,delete l.values;for(var n in l.points){var x=l.points[n];(null===v.describe.startTime||x.time<=v.describe.startTime)&&(v.describe.startTime=x.time),(null===v.describe.endTime||x.time>=v.describe.endTime)&&(v.describe.endTime=x.time)}}v.describe.barCount=v.timelines.length,v.describe.barNames=t.map(v.timelines,function(t){return t.name}).keys()}this.version="1.0",this.element=null,this.option=null,this.timelines=[],this.describe=null,this.area=null,h(e)?this.element=t.select("body"):c(e)?this.element=t.select(e):this.element=e,this.element.attr("class","hydrochart"),this.option=$.extend({},a,n);var v=this;this.draw=function(t){return p(t),this.refresh(),this},this.refresh=function(t){return this.element.html(""),this.area=new l(this.option,this.element,this.describe,t),this.area.drawLegend().draw().drawChart(this.timelines).drawAsix().drawCurrentLine().drawHoverLine().bind_check().bind_dbclick().bind_popover(),this},this.getData=function(){return p(this.area.getData()),this.timelines}}),h=function(t){return void 0===t||null===t},c=function(t){return!h(t)&&"string"==typeof t},u=function(t){return t[0]},d=function(t){return t[t.length-1]};return{chart:o}}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2)],void 0!==(l=function(t,e,i){var n=function(t,e,i,n,l){this.xAxis=null,this.yAxis=null,this.axis_svg=t,this.axis_option=e,this.axis_params=i,this.axis_xScale=n,this.axis_yScale=l};return n.prototype={drawAxis:function(){this.xAxis=t.axisBottom().scale(this.axis_xScale).tickFormat(function(t){var e=i(t).format("HH:mm");return"00:00"==e?i(t).format("MM/DD HH:mm"):e}).ticks(24),this.axis_svg.append("g").attr("class","axis axis--x").attr("transform","translate("+this.axis_option.padding.left+","+(this.axis_params.size.height-this.axis_option.padding.bottom)+")").call(this.xAxis),this.yAxis=t.axisLeft().scale(this.axis_yScale),this.axis_svg.append("g").attr("class","axis axis--y").attr("transform","translate("+this.axis_option.padding.left+","+this.axis_option.padding.top+")").call(this.yAxis);var e=$(".axis.axis--x").find("text"),n=_.filter(e,function(t){if(t.innerHTML.includes("00:00")&&"00:00"!=t.innerHTML)return t});return _.each(n,function(t){var e=t.innerHTML,i=e.substr(0,5),n=t.cloneNode();$(n).attr("y",21).html(i),$(t).html("00:00"),t.parentElement.appendChild(n)}),this},remove:function(){return this.xAxis.remove(),this.yAxis.remove(),this},getxAxis:function(){return this.xAxis},getyAxis:function(){return this.yAxis}},n}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3)],void 0!==(l=function(t,e,i,n){var l=function(t){return void 0===t||null===t},a=function(t){this.button=null,this.button_svg=t};return a.prototype={add:function(t,e,i){var n="btn";return l(i)||(n+=" "+i),this.button=this.button_svg.append("button").attr("class",n).text(t).attr("width",35).attr("height",20).attr("style","float:"+e),this},update:function(t,e){return null!=this.button&&(void 0!=t&&this.button.attr("x",t),void 0!=e&&this.button.attr("y",e)),this},remove:function(){return null!=this.button&&this.button.remove(),this},click_Event:function(t){if("function"==typeof t){this.callFn=t;this.button.on("click",function(e,i,n){t.call(e,n)})}return this},setDisabled:function(t){null!=this.button&&(t?this.button.attr("disabled",t):this.button.attr("disabled",null))}},a}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3),i(14)],void 0!==(l=function(t,e,i,n,l){var a={start:"start",end:"end"},r=function(t,e,i){this.d3g=t,this.handle=null,this.handleText=null,this.handle_xScale=e,this.pos=[],this.minX=0,this.maxX=null,this.distance=28,this.type=a[i]};return r.prototype={drawHandle:function(t,e,i){return this.handle=this.d3g.append("rect").attr("class",i||"edit_rect").attr("x",t).attr("y",e).attr("width",4).attr("height",30),this.pos[0]=t,this.pos[1]=e,this},drawHandleText:function(t,e){var n=t+4,a=t;"end"==this.type&&(n=t-this.distance-4,a=t+4);var r=i(this.handle_xScale.invert(a)).format("HH:mm");return this.handleText=new l(this.d3g),this.handleText.drawText(r,"edit_text",n,e),this},drag_Event:function(e,i,n){var l=this,a=function(){var i=t.mouse(this),n=i[0];"function"==typeof e&&e.call(null,n)},r=function(){var e=t.mouse(this),n=e[0];n<l.minX&&(n=l.minX),null!=l.maxX&&n>l.maxX&&(n=l.maxX),"function"==typeof i&&i.call(null,n),l.updatePos(n)},s=function(){var e=t.mouse(this),i=e[0];i<l.minX&&(i=l.minX),null!=l.maxX&&i>l.maxX&&(i=l.maxX),"function"==typeof n&&n.call(null,i)},o=t.drag().on("start",a).on("drag",r).on("end",s);return this.handle.call(o),this},updatePos:function(t,e){if(void 0!=t){var n=t,l=t+4;"end"==this.type&&(t-=4,l=t-this.distance-4),this.pos[0]=t,this.handle.attr("x",t);var a=i(this.handle_xScale.invert(n)).format("HH:mm");this.handleText.update(a,l)}void 0!=e&&this.handle.attr("y",e)},updateTextPos:function(){},removeHandle:function(){return this.handle.remove(),this.handleText.removeText(),this},removeAllHandle:function(){return t.selectAll(".edit_rect").remove(),t.selectAll(".edit_text").remove(),this},setMinX:function(t){return this.minX=t,this},setMaxX:function(t){return this.maxX=t,this},getX:function(){return this.pos}},r}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3),i(8)],void 0!==(l=function(t,e,i,n,l){var a=function(t){this.legend_svg=t,this.legend_div=null,this.add_button=null,this.update_button=null,this.delete_button=null,this.cancel_button=null};return a.prototype={draw:function(t,e){var i="width:"+t+"px;height:"+(e||30)+"px;";return this.legend_div=this.legend_svg.append("div").attr("class","legend").attr("style",i),this},drawAddBtn:function(t,e){var i=new l(this.legend_div);return this.add_button=i.add("新增",t,"green btn-sm").click_Event(e),this},drawUpdateBtn:function(t,e){var i=new l(this.legend_div);return this.update_button=i.add("编辑",t,"blue btn-sm").click_Event(e),this},drawDeleteBtn:function(t,e){var i=new l(this.legend_div);return this.delete_button=i.add("删除",t,"red btn-sm").click_Event(e),this},drawCancelBtn:function(t,e){var i=new l(this.legend_div);return this.cancel_button=i.add("取消",t,"yellow btn-sm").click_Event(e),this}},a}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3),i(4)],void 0!==(l=function(t,e,i,n,l){function a(t){return t.value>0?t.className=r:0==t.value?t.className=s:t.value<0?t.className=o:t.className=h,t.className}var r="rect open_state",s="rect close_state",o="rect fault_state",h="rect indefinite_state",c=50,u=function(t){return void 0===t||null===t},d=function(t,e){this.version="1.0",this.blockType="numeric",this.block=null,this.blockText=null,this.leftBlock=null,this.rightBlock=null,this.blockData=null,this.block_Line=t,this.block_xScale=e,this.callFn=null};return d.prototype={draw:function(t){t.value>c&&(t.value=c,t.label=c.toString());var e=this;return this.block=this.block_Line.append("rect").datum(t).attr("class",function(t,e){return a(t)}).attr("x",function(t,i){return void 0==t.x&&(t.x=e.block_xScale(t.time)),t.x}).attr("y",0).attr("width",function(t,i){return void 0==t.width&&(t.width=0),t.next&&(t.width=e.block_xScale(t.next.time)-e.block_xScale(t.time)),t.width<0&&(t.width=0),t.width}).attr("height",function(t,e){return t.height=22,22}).attr("data-toggle","popover"),this.blockData=t,this},drawText:function(){return this.blockText=new l(this.block_Line,this.block_xScale),this.blockText.draw(this.blockData),this},update:function(t,e,i,n){return u(t)||this.block.attr("x",t),u(e)||this.block.attr("y",e),u(i)||this.block.attr("width",i),null!=this.blockText&&this.blockText.update(t,e,i),"function"==typeof n&&n.call(t,e),this},updateWidth:function(t,e){return u(t)||this.block.attr("width",t),"function"==typeof e&&e.call(x,y),this},addWidth:function(t,e){if(!u(t)){var i=parseFloat(this.block.attr("width")),n=i+t;this.block.attr("width",n)}return"function"==typeof e&&e.call(x,y),this},setLeft:function(t){return u(t)||(this.leftBlock=t),this},setRight:function(t){return u(t)||(this.rightBlock=t),this},changeLeft:function(){var t=this;if(null!=t.block){var e=parseFloat(t.block.attr("x"));if(t.leftBlock){var i=parseFloat(t.leftBlock.block.attr("x")),n=e-i;n<=0?(t.leftBlock.remove(),t.changeLeft()):t.leftBlock.update(null,null,n)}else if(t.blockData.className!=h){var l={height:22,time:t.block_xScale.invert(0),value:null,label:"不定",width:e},a=new d(t.block_Line,t.block_xScale);a.draw(l).drawText(l).click_Event(t.callFn).setRight(t),t.leftBlock=a}}return this},changeRight:function(){var t=this,e=parseFloat(t.block.attr("x")),i=parseFloat(t.block.attr("width")),n=e+i;if(t.rightBlock){var l=parseFloat(t.rightBlock.block.attr("x")),a=parseFloat(t.rightBlock.block.attr("width")),r=l+a,s=r-n;s<=0?(t.rightBlock.remove(),t.changeRight()):t.rightBlock.update(n,null,s)}else{var o=this.block_Line.lineWidth,h={height:22,time:t.block_xScale.invert(n),value:null,label:"不定",width:o},c=new d(t.block_Line,t.block_xScale);c.draw(h).drawText(h).click_Event(t.callFn).setLeft(t),t.rightBlock=c}return this},updateState:function(t){if(this.blockData=t,this.block.datum(t).attr("class",function(t,e){return a(t)}),null!=this.rightBlock&&this.blockData.label==this.rightBlock.blockData.label){var e=parseFloat(this.rightBlock.block.attr("width"));this.addWidth(e),this.rightBlock.remove()}if(null!=this.leftBlock&&this.blockData.label==this.leftBlock.blockData.label){var e=parseFloat(this.block.attr("width"));this.leftBlock.addWidth(e),this.remove()}this.blockText&&this.blockText.updateText(t)},click_Event:function(t){if("function"==typeof t){this.callFn=t;var e=this;null!=this.block&&this.block.on("click",function(i,n,l){t.call(i,n,l,e)})}return this},dbclick_Event:function(t){return this.block.on("dblclick",function(e,i,n){"function"==typeof t&&t.call(e,i,n)}),this},remove:function(){if(this.block.remove(),this.block=null,this.blockData=null,null!=this.leftBlock&&(this.leftBlock.rightBlock=this.rightBlock),null!=this.rightBlock&&(this.rightBlock.leftBlock=this.leftBlock),this.rightBlock&&this.leftBlock&&this.leftBlock.blockData.label==this.rightBlock.blockData.label){var t=parseFloat(this.leftBlock.block.attr("x")),e=parseFloat(this.rightBlock.block.attr("x"))+parseFloat(this.rightBlock.block.attr("width")),i=e-t;this.leftBlock.update(t,null,i),this.rightBlock.remove()}null!=this.blockText&&this.blockText.remove()},insertCentre:function(){if(this.blockData.className!=o){var t=parseFloat(this.block.attr("width")),e=this.rightBlock,i=parseInt(t),n=parseFloat(this.block.attr("x")),l=i/3,a=n+l,s=a+l;this.updateWidth(l);var h={height:22,time:this.block_xScale.invert(a),value:1,label:"开",width:l,x:a};this.blockData.className==r&&(h.label="关",h.value=0);var c=new d(this.block_Line,this.block_xScale);c.draw(h).drawText(h).click_Event(this.callFn).setLeft(this);var u={height:22,time:this.block_xScale.invert(s),value:this.blockData.value,label:this.blockData.label,width:l,x:s},p=new d(this.block_Line,this.block_xScale);p.draw(u).drawText(u).click_Event(this.callFn).setLeft(c).setRight(e),e.setLeft(p),c.setRight(p),this.setRight(c)}return this}},d}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3),i(4)],void 0!==(l=function(t,e,i,n,l){function a(t){return t.value>0?t.className=r:0==t.value?t.className=s:t.value<0?t.className=o:t.className=h,t.className}var r="rect open_state",s="rect close_state",o="rect fault_state",h="rect indefinite_state",c=function(t){return void 0===t||null===t},u=function(t,e){this.version="1.0",this.blockType="state",this.block=null,this.blockText=null,this.leftBlock=null,this.rightBlock=null,this.blockData=null,this.block_Line=t,this.block_xScale=e,this.callFn=null};return u.prototype={draw:function(t){var e=this;return this.block=this.block_Line.append("rect").datum(t).attr("class",function(t,e){return a(t)}).attr("x",function(t,i){return void 0==t.x&&(t.x=e.block_xScale(t.time)),t.x}).attr("y",0).attr("width",function(t,i){return void 0==t.width&&(t.width=0),t.next&&(t.width=e.block_xScale(t.next.time)-e.block_xScale(t.time)),t.width<0&&(t.width=0),t.width}).attr("height",function(t,e){return t.height=22,22}),void 0==t.value&&this.block.attr("data-toggle","popover").attr("data-content",'<button id="openBtn" class="popoverBtn green" >开</button><button id="closeBtn" class="popoverBtn red" >关</button>'),this.blockData=t,this},drawText:function(){return this.blockText=new l(this.block_Line,this.block_xScale),this.blockText.draw(this.blockData),this},update:function(t,e,i,n){return c(t)||this.block.attr("x",t),c(e)||this.block.attr("y",e),c(i)||this.block.attr("width",i),null!=this.blockText&&this.blockText.update(t,e,i),"function"==typeof n&&n.call(t,e),this},updateWidth:function(t,e){return c(t)||this.block.attr("width",t),"function"==typeof e&&e.call(x,y),this},addWidth:function(t,e){if(!c(t)){var i=parseFloat(this.block.attr("width")),n=i+t;this.block.attr("width",n)}return"function"==typeof e&&e.call(x,y),this},setLeft:function(t){return c(t)||(this.leftBlock=t),this},setRight:function(t){return c(t)||(this.rightBlock=t),this},changeLeft:function(){var t=this;if(null!=t.block){var e=parseFloat(t.block.attr("x"));if(t.leftBlock){var i=parseFloat(t.leftBlock.block.attr("x")),n=e-i;n<=0?(t.leftBlock.remove(),t.changeLeft()):t.leftBlock.update(null,null,n)}else if(t.blockData.className!=h){var l={height:22,time:t.block_xScale.invert(0),value:null,label:"不定",width:e},a=new u(t.block_Line,t.block_xScale);a.draw(l).drawText(l).click_Event(t.callFn).setRight(t),t.leftBlock=a}}return this},changeRight:function(){var t=this,e=parseFloat(t.block.attr("x")),i=parseFloat(t.block.attr("width")),n=e+i;if(t.rightBlock){var l=parseFloat(t.rightBlock.block.attr("x")),a=parseFloat(t.rightBlock.block.attr("width")),r=l+a,s=r-n;s<=0?(t.rightBlock.remove(),t.changeRight()):t.rightBlock.update(n,null,s)}else{var o=this.block_Line.lineWidth,h={height:22,time:t.block_xScale.invert(n),value:null,label:"不定",width:o},c=new u(t.block_Line,t.block_xScale);c.draw(h).drawText(h).click_Event(t.callFn).setLeft(t),t.rightBlock=c}return this},updateState:function(t){if(this.block.attr("class",function(t,e){return a(t)}),null!=this.rightBlock&&this.blockData.label==this.rightBlock.blockData.label){var e=parseFloat(this.rightBlock.block.attr("width"));this.addWidth(e),this.rightBlock.remove()}if(null!=this.leftBlock&&this.blockData.label==this.leftBlock.blockData.label){var e=parseFloat(this.block.attr("width"));this.leftBlock.addWidth(e),this.remove()}this.blockText&&this.blockText.updateText(t)},click_Event:function(t){if("function"==typeof t){this.callFn=t;var e=this;null!=this.block&&this.block.on("click",function(i,n,l){t.call(i,n,l,e)})}return this},dbclick_Event:function(t){var e=this;return this.block.on("dblclick",function(i,n,l){0==i.value?(i.value=1,i.label="开"):1==i.value?(i.value=0,i.label="关"):void 0==i.value&&(i.value=1,i.label="开"),e.updateState(i),"function"==typeof t&&t.call(i,n,l)}),this},remove:function(){if(this.block.remove(),this.block=null,this.blockData=null,null!=this.leftBlock&&(this.leftBlock.rightBlock=this.rightBlock),null!=this.rightBlock&&(this.rightBlock.leftBlock=this.leftBlock),this.rightBlock&&this.leftBlock&&this.leftBlock.blockData.label==this.rightBlock.blockData.label){var t=parseFloat(this.leftBlock.block.attr("x")),e=parseFloat(this.rightBlock.block.attr("x"))+parseFloat(this.rightBlock.block.attr("width")),i=e-t;this.leftBlock.update(t,null,i),this.rightBlock.remove()}null!=this.blockText&&this.blockText.remove()},insertCentre:function(){if(this.blockData.className!=o){var t=parseFloat(this.block.attr("width")),e=this.rightBlock,i=parseInt(t),n=parseFloat(this.block.attr("x")),l=i/3,a=n+l,s=a+l;this.updateWidth(l);var h={height:22,time:this.block_xScale.invert(a),value:1,label:"开",width:l,x:a};this.blockData.className==r&&(h.label="关",h.value=0);var c=new u(this.block_Line,this.block_xScale);c.draw(h).drawText(h).click_Event(this.callFn).setLeft(this);var d={height:22,time:this.block_xScale.invert(s),value:this.blockData.value,label:this.blockData.label,width:l,x:s},p=new u(this.block_Line,this.block_xScale);p.draw(d).drawText(d).click_Event(this.callFn).setLeft(c).setRight(e),null!=e&&e.setLeft(p),c.setRight(p),this.setRight(c)}return this}},u}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(12),i(11),i(2),i(3)],void 0!==(l=function(t,e,i,n,l){var a=(t.timeParse("%Y-%m-%d %H:%M:%S"),t.timeParse("%H:%M"),t.timeParse("%Y-%m-%d %H:%M"),5),r=function(t,e,i,n,l){this.g=null,this.version="1.0",this.blocks=[],this.lineWidth=parseFloat(t.attr("width"))-n.padding.left-n.padding.right,this.line_svg=t,this.line_option=n,this.line_xScale=e,this.line_yScale=i,this.line_describe=l,this.valueGrade=[]};return r.prototype={drawLine:function(t){var e=this,l=this.line_yScale(t.name)+this.line_option.padding.top+10-.2*this.line_describe.barCount;return this.g=this.line_svg.append("g").attr("transform","translate("+this.line_option.padding.left+","+l+")"),t.points.length>0&&_.each(t.points,function(l){var a=null;"CSP"==t.type?a=new i(e.g,e.line_xScale):"RSP"==t.type&&(a=new n(e.g,e.line_xScale)),a.draw(l).drawText();var r=null,s=e.blocks.length;s>0&&(r=e.blocks[s-1],a.setLeft(r),r.setRight(a)),e.blocks.push(a)}),this},getValueGrade:function(t){for(var e=[],i=t/a,n=0;n<=a;n++)e.push(n*i);this.valueGrade=e},checkBlock_Event:function(t){return"function"==typeof t&&_.each(this.blocks,function(e){e.click_Event(t)}),this},dbclick_Event:function(t){return"function"==typeof t&&_.each(this.blocks,function(e){e.dbclick_Event(t)}),this},remove:function(){return this.g.remove(),this},popover:function(){function t(t){return'<input type="number" id="pumpvalue" name="pumpvalue" style="width: 50px" value='+t+'><button class="popoverBtn red" onclick="btnClick()">关</button>'}$("[data-toggle='popover']").each(function(e,i){var n=i.__data__.value;null!=n&&void 0!=n||(n=""),$(i).popover({trigger:"click",container:"body",placement:"top",html:"true",content:t(n),animation:!1}).on("click",function(){var t=this;$(this).popover("show"),$(this).siblings(".popover").on("mouseleave",function(){$(t).popover("hide")})}).on("mouseleave",function(){var t=this;setTimeout(function(){$(".popover:hover").length||$(t).popover("hide")},100)})})}},r}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3)],void 0!==(l=function(t,e,i,n){var l=function(t){return void 0===t||null===t},a=function(t){this.version="1.0",this.text=null,this.g=t};return a.prototype={drawText:function(t,e,i,n){return this.text=this.g.append("text").attr("class",e||"label").text(t).attr("x",i).attr("y",n),this},moveText:function(t,e){l(t)||this.text.attr("x",t),l(e)||this.text.attr("y",e)},update:function(t,e,i){return l(t)||this.text.text(t),l(e)||this.text.attr("x",e),l(i)||this.text.attr("y",i),this},removeText:function(){this.text.remove()}},a}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3),i(16)],void 0!==(l=function(t,e,i,n,l){var a=function(t,e,i,n,l){this.version="1.0",this.currentLine=null,this.currentText=null,this.isShow=!1,this.showText=!1,this.time_svg=t,this.time_option=e,this.time_params=i,this.time_xScale=n,l&&(this.showText=l)};return a.prototype={drawLine:function(t,e){return this.currentLine=this.time_svg.append("line").attr("class",t).classed("hide",!1).attr("x1",-1).attr("x2",-1).attr("y1",this.time_option.padding.top).attr("y2",this.time_params.size.height-this.time_option.padding.bottom),this.showText&&(this.currentText=new l(this.time_svg,this.time_xScale,this.time_option),this.currentText.drawText(e)),this},showLine:function(t,e){return this.currentLine.classed("hide",!1).attr("x1",t).attr("x2",t),this.showText&&this.currentText.showText(t),this.isShow=!0,this},moveLine:function(t){return this.currentLine.attr("x1",t).attr("x2",t),this.showText&&this.currentText.showText(t),this},hideLine:function(){return this.currentLine.classed("hide",!0).attr("x1",-1).attr("x2",-1),this.showText&&this.currentText.hideText(),this.isShow=!1,this}},a}.apply(e,n))&&(t.exports=l)},function(t,e,i){var n,l;n=[i(0),i(1),i(2),i(3)],void 0!==(l=function(t,e,i,n){var l=function(t,e,i){this.version="1.0",this.timeText=null,this.time_svg=t,this.time_xScale=e,this.time_option=i};return l.prototype={drawText:function(t){return this.timeText=this.time_svg.append("text").attr("class",t).text("00:00").style("opacity",0).attr("x",-1).attr("y",this.time_option.padding.top+8),this},showText:function(t,e){var i=this.time_xScale.invert(t-this.time_option.padding.left),n=i.toLocaleTimeString("zh-CN",{hour12:!1}).substr(0,5);return this.timeText.style("opacity",1).text(n).attr("x",t),this},hideText:function(){return this.timeText.style("opacity",0).attr("x",-1),this}},l}.apply(e,n))&&(t.exports=l)}])});